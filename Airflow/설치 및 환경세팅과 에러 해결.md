### ì•ìœ¼ë¡œ ê³„ì† ë‚˜ì˜¬ ìš©ì–´ì™€ ê°œë…ë“¤

- **ì›Œí¬í”Œë¡œìš°** : ì‘ì—…ë“¤ì˜ ì§‘í•©. ì„œë¡œ ì¢…ì†ë˜ì–´ ìˆë‹¤.
- **DAG** (=Directed Acyclic Graph - ë°©í–¥ì´ ìˆëŠ” ë¹„ìˆœí™˜ ê·¸ë˜í”„ )
ì»¤ë‹¤ë€ ì‘ì—…ì„ ì§„í–‰í•˜ëŠ” ê³¼ì •ì„ ë§í•œë‹¤. Airflowì˜ í•µì‹¬ êµ¬ì¡°ì´ë‹¤. 
ì´ DAGëŠ” í•œ í”„ë¡œì íŠ¸ì— ì—¬ëŸ¬ ê°œ ì¡´ì¬í•  ìˆ˜ ìˆë‹¤.
- Task : ëŒ€ê·¸ë¥¼ ì´ë£¨ê³  ìˆëŠ” ë‹¨ìœ„ êµ¬ì„±ìš”

### Airflow êµ¬ì„± ìš”ì†Œ

- Airflow ì‚¬ìš©ì : ë³¸ì¸ ë˜ëŠ” ê´€ë¦¬ì
- ì›¹ ì„œë²„ : ì‚¬ìš©ìê°€ ì‘ì—…ì„ ê´€ë¦¬í•˜ê³  í†µì œí•  ìˆ˜ ìˆë„ë¡ ì •ë¦¬ëœ í™”ë©´
- **ìŠ¤ì¼€ì¤„ëŸ¬** : ì›Œí¬í”Œë¡œìš° ì‹œê°„ ê´€ë¦¬
- **Metastore**Â ğŸ“‘ : ì—¬ëŸ¬ ëŒ€ê·¸ ì •ë³´ë¥¼ ì¨ë†“ì€ íŒŒì¼ì² . ëŒ€ê·¸ê°€ ì˜ ì§„í–‰ë˜ì—ˆëŠ”ì§€, ì¤‘ê°„ì— ì–´ëŠ ê³¼ì •ì—ì„œ ë§í–ˆëŠ”ì§€, ì„±ê³µí–ˆëŠ”ì§€ ë“±ì„ ì ì–´ë†“ëŠ”ë‹¤.
- **Executor**Â ğŸ‘· : ì‘ì—…ì„ ë°°ì¹˜í•˜ëŠ” ì‘ì—… ë°˜ì¥
- **Worker**Â ğŸ‘©â€ğŸ”§ : ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” ì¼ê¾¼
- **Operator**Â âš™ï¸ : ì‘ì—…ì„ ìˆ˜í–‰í•  ë•Œ ì‚¬ìš©í•˜ëŠ” ê¸°ê³„. ê³µì¥ì¥ì´ ì´ëŸ° ê¸°ê³„ë“¤ì„ ì„¤ê³„í•´ì„œ(íŒŒì´ì¬ ì½”ë“œë¡œ) ê³µì • ìˆœì„œëŒ€ë¡œ ì—®ì–´ì£¼ë©´ í•œ ëŒ€ê·¸ê°€ ì™„ì„±ëœë‹¤.

AirflowëŠ” ì‹¤ì‹œê°„ìœ¼ë¡œ, ì´ˆë‹¨ìœ„ë¡œ ì§„í–‰ë˜ì–´ì•¼ í•˜ëŠ” ê³µì •ì—ëŠ” ì í•©í•˜ì§€ ì•Šë‹¤. ë³´ì„ ê³µì¥ì²˜ëŸ¼ í•˜ë£¨ í•œ ë²ˆ, ì¼ì£¼ì¼ì— í•œ ë²ˆ ì´ë ‡ê²Œ ì§„í–‰ë˜ëŠ” ê³µì •ì„ ê´€ë¦¬í•˜ëŠ” ë°ì— ì í•©í•˜ë‹¤.

- ì„¤ì¹˜í•˜ê¸°
    
    í˜„ì¬ ë‚´ íŒŒì´ì¬ ë²„ì „ì€ 3.9.13 ì´ë¯€ë¡œ,
    
    `conda create -n airflow_env python=3.9.13` í–ˆë‹¤. ê·¸ëŸ°ë°
    
    ì•„ë˜ì˜ ê²½ê³  ë•Œë¬¸ì—
    
    ```powershell
    ==> WARNING: A newer version of conda exists. <==
    current version: 22.9.0
    latest version: 23.7.3
    Please update conda by running
    ```
    
    `conda update -n base -c defaults conda` ë¥¼ ì…ë ¥í•œë‹¤. ê·¸ë¦¬ê³  ê³„ì† ì´ì–´ë‚˜ê°„ë‹¤.
    
    `pip3 install apache-airflow` â€¦ ê·¸ëŸ°ë°
    
    ê²°ë¡  : ìœˆë„ìš°ì—ëŠ” ì§ì ‘ Airflowë¥¼ ì„¤ì¹˜í•  ìˆ˜ ì—†ë‹¤
    
    ê·¸ë˜ì„œ ê°€ìƒí™˜ê²½ ì†Œí”„íŠ¸ì›¨ì–´ë¥¼ ì°¾ì•„ë³¸ë‹¤. VMware, VirtualBox ë‘ ê°œê°€ ìˆëŠ”ë°, ìš©ëŸ‰ì´ ë” ì‘ì€ í›„ìë¥¼ ì„ íƒí–ˆë‹¤.
    
    https://www.virtualbox.org/wiki/Downloads ì—¬ê¸°ì„œ ë‹¤ìš´ë°›ê³ , ì„¤ì¹˜ì˜µì…˜ ë§Œì§ˆ ê²ƒ ì—†ì´ ì­‰ ê°„ë‹¤.
    
    ìš°ë¶„íˆ¬ë¥¼ ì„¤ì¹˜í•˜ì˜€ë‹¤. ì´ì  â€¦ ë¦¬ëˆ…ìŠ¤ ë°­ì´ ì‹œì‘ëë‹¤. ìš°ë¶„íˆ¬ì— íŒŒì´ì¬ì„ ì„¤ì¹˜í•˜ì
    
    ìš°í´ë¦­, ì˜¤í”ˆ í„°ë¯¸ë„ ëˆ„ë¥´ê³  sudo apt install python ì…ë ¥í•œë‹¤.
    
    ê·¸ë¦¬ê³  python --version ì…ë ¥í•˜ë‹ˆ ë²„ì „ì€ ë‚®ì•˜ìœ¼ë‚˜ 2.7.18ì´ ì˜ ëœ¬ê²ƒì„ í™•ì¸í•˜ê³  pip install apache-airflowë¥¼ ì„¤ì¹˜í–ˆì§€ë§Œ pip ì¸ì‹ ë¶ˆê°€ë¡œ ì•ˆëë‹¤.
    
    ê·¸ëŸ°ë° ë˜‘ë˜‘í•œ ìš°ë¶„íˆ¬ê°€ sudo apt install python3-pip í•˜ë¼ê³  ì•Œë ¤ì¤˜ì„œ ì…ë ¥ í•œ í›„
    airflowë¥¼ ì„¤ì¹˜í–ˆë‹¤.
    
    `mysqladmin -u root create testbook -p`
    
    E: mysqlclient ì´ ì˜¤ë¥˜ë§Œ ë‚¬ëŠ”ë° ìš°ë¶„íˆ¬ê°€ `sudo apt install mysql-client-core-8.0` í•˜ë¼ê³  í–ˆë‹¤.
    
    ì•Œì•½ì´ë‘ VirtureBoxì˜ ì¶©ëŒë¡œ, ê°€ìƒí™˜ê²½ì—ì„œ í•˜ëŠ”ê²Œ í™”ë”±ì§€ê°€ ë‚¬ë‹¤â€¦. ê·¸ë˜ì„œ Microsoft Appstoreë¡œ ê°€ì„œ ìš°ë¶„íˆ¬ë¥¼ ë‹¤ìš´ë°›ê³ , Window Linux í™˜ê²½ì—ì„œ ì‹¤í–‰í–ˆë‹¤.
    
    Window Powershell ì‹¤í–‰ í›„
    
    ```powershell
    wsl --install --ë¹¼ë¨¹ìœ¼ë©´ ì•ˆë¨. ì£¼ì˜
    ì•„ë˜ëŠ” ê·¸ ê²°ê³¼. ID : gloryword PW : 0075007
    
    PS C:\Users\dlwhd> wsl --install
    Ubuntuì´(ê°€) ì´ë¯¸ ì„¤ì¹˜ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
    Ubuntuì„(ë¥¼) ì‹œì‘í•˜ëŠ” ì¤‘...
    Installing, this may take a few minutes...
    Please create a default UNIX user account. The username does not need to match your Windows username.
    For more information visit: https://aka.ms/wslusers
    Enter new UNIX username: gloryword
    New password:
    Retype new password:
    passwd: password updated successfully
    ì‘ì—…ì„ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤.
    Installation successful!
    To run a command as administrator (user "root"), use "sudo <command>".
    See "man sudo_root" for details.
    
    Welcome to Ubuntu 22.04.2 LTS (GNU/Linux 5.15.90.1-microsoft-standard-WSL2 x86_64)
    
     * Documentation:  https://help.ubuntu.com
     * Management:     https://landscape.canonical.com
     * Support:        https://ubuntu.com/advantage
    
    This message is shown once a day. To disable it please create the
    /home/gloryword/.hushlogin file.
    ```
    
    ê·¸ í›„ Powershell ê´€ë¦¬ì ì‹¤í–‰ í›„ì— wsl -l -v í–ˆì„ ì‹œì—, Ubuntuë²„ì „ì´ ê¼­ 2ë¡œ ë‚˜ì™€ì•¼í•œë‹¤.
    
    ì‹œì‘â†’ wsl ê²€ìƒ‰ í›„ ì‹¤í–‰í•˜ë‹ˆ ë°”ë¡œ êº¼ì§€ê¸¸ë˜ ê²€ìƒ‰. ì›ì¸ì€ ê¸°ë³¸ê°’ì´ dockerë¡œ ë˜ì–´ìˆì–´ì„œ ê·¸ë ‡ë‹¤.
    
    powershell í‚¤ê³  `wslconfig /setdefault Ubuntu` ì…ë ¥.
    
    ì°¸ê³  : `wsl --list, wsl -l -v` ëª…ë ¹ì–´ë¡œ í˜„ ìƒíƒœ ì¡°íšŒê°€ëŠ¥.
    
    ~~ê± ì•ˆë˜ê² ë‹¤ ì  ì¥ powershell ëˆ„ë¥´ê³  wsl  --installë¡œë§Œ ë“¤ì–´ê°€ì~~
    
    ì•„ë‹ˆâ€¦ wsl ëˆ„ë¥´ë©´ ê²½ë¡œ ì´ìƒí•˜ê²Œ ë‚˜ì˜¬í…ë°, ê± cd ì—”í„° ì¹˜ë©´ ëœë‹¤.
    
    ```powershell
    gloryword@Doldari-Teenager:/mnt/c/WINDOWS/system32$ cd
    gloryword@Doldari-Teenager:~$
    ```
    
    ì´ë ‡ê²Œ ë¨.
    
    [Install Docker Engine on Ubuntu](https://docs.docker.com/engine/install/ubuntu/)
    
    [[ë°ì´í„° ì—”ì§€ë‹ˆì–´ë§ with Airflow] 4ê°•. ë„ì»¤ë¥¼ ì‚¬ìš©í•˜ì—¬ Airflow ì„¤ì¹˜í•˜ê¸°](https://www.youtube.com/watch?v=_6FaI70td34)
    
    ì´ê±° ë³´ê³ í–ˆë‹¤..
    
    powershellì—ì„œëŠ” 
    
    `sudo service docker start`
    
    ì»´ í‚¤ë©´ í•­ìƒ í•´ì¤˜ì•¼í•˜ëŠ” ëª…ë ¹ì–´ì„.
    
    ì´ì œ ë“œë””ì–´ Airflow ì„¤ì¹˜í•˜ëŠ”ë°, ì•„ë˜ ë³´ê³  í–ˆë‹¤.
    
    [Running Airflow in Docker â€” Airflow Documentation](https://airflow.apache.org/docs/apache-airflow/stable/howto/docker-compose/index.html)
    
    ë‚˜ì¤‘ì— ì˜ìƒë³´ê¸° ê·€ì°®ì„ê¹Œë´ ê¸€ë¡œ ë‚¨ê²¨ë‘ . ìœ„ ì‚¬ì´íŠ¸ ë‚´ìš© ì¶”ì¶œí•œê±°ì„.
    
    ```powershell
    curl -LfO 'https://airflow.apache.org/docs/apache-airflow/2.7.0/docker-compose.yaml'
    
    mkdir -p ./dags ./logs ./plugins ./config ì´ê±° ë¨¼ì € ì‹¤í–‰í•˜ê³ 
    echo -e "AIRFLOW_UID=$(id -u)" > .env ì´ê±° ì‹¤í–‰í•˜ê¸°.
    ì•„ë˜ëŠ” ì‹¤ì œ ê²°ê³¼ ê¸°ë¡
    
    gloryword@Doldari-Teenager:~$ mkdir -p ./dags ./logs ./plugins ./config
    gloryword@Doldari-Teenager:~$ ls -al
    total 60
    drwxr-x--- 7 gloryword gloryword  4096 Aug 31 20:54 .
    drwxr-xr-x 3 root      root       4096 Aug 31 20:30 ..
    -rw------- 1 gloryword gloryword    11 Aug 31 20:41 .bash_history
    -rw-r--r-- 1 gloryword gloryword   220 Aug 31 20:30 .bash_logout
    -rw-r--r-- 1 gloryword gloryword  3771 Aug 31 20:30 .bashrc
    drwx------ 2 gloryword gloryword  4096 Aug 31 20:30 .cache
    -rw-r--r-- 1 gloryword gloryword     0 Aug 31 20:30 .motd_shown
    -rw-r--r-- 1 gloryword gloryword   807 Aug 31 20:30 .profile
    -rw-r--r-- 1 gloryword gloryword     0 Aug 31 20:42 .sudo_as_admin_successful
    -rw------- 1 gloryword gloryword   760 Aug 31 20:52 .viminfo
    drwxr-xr-x 2 gloryword gloryword  4096 Aug 31 20:54 config
    drwxr-xr-x 2 gloryword gloryword  4096 Aug 31 20:54 dags
    -rw-r--r-- 1 gloryword gloryword 11783 Aug 31 20:51 docker-compose.yaml
    drwxr-xr-x 2 gloryword gloryword  4096 Aug 31 20:54 logs
    drwxr-xr-x 2 gloryword gloryword  4096 Aug 31 20:54 plugins
    gloryword@Doldari-Teenager:~$ echo -e "AIRFLOW_UID=$(id -u)" > .env
    gloryword@Doldari-Teenager:~$ ls -al
    total 64
    drwxr-x--- 7 gloryword gloryword  4096 Aug 31 20:55 .
    drwxr-xr-x 3 root      root       4096 Aug 31 20:30 ..
    -rw------- 1 gloryword gloryword    11 Aug 31 20:41 .bash_history
    -rw-r--r-- 1 gloryword gloryword   220 Aug 31 20:30 .bash_logout
    -rw-r--r-- 1 gloryword gloryword  3771 Aug 31 20:30 .bashrc
    drwx------ 2 gloryword gloryword  4096 Aug 31 20:30 .cache
    -rw-r--r-- 1 gloryword gloryword    17 Aug 31 20:55 .env
    -rw-r--r-- 1 gloryword gloryword     0 Aug 31 20:30 .motd_shown
    -rw-r--r-- 1 gloryword gloryword   807 Aug 31 20:30 .profile
    -rw-r--r-- 1 gloryword gloryword     0 Aug 31 20:42 .sudo_as_admin_successful
    -rw------- 1 gloryword gloryword   760 Aug 31 20:52 .viminfo
    drwxr-xr-x 2 gloryword gloryword  4096 Aug 31 20:54 config
    drwxr-xr-x 2 gloryword gloryword  4096 Aug 31 20:54 dags
    -rw-r--r-- 1 gloryword gloryword 11783 Aug 31 20:51 docker-compose.yaml
    drwxr-xr-x 2 gloryword gloryword  4096 Aug 31 20:54 logs
    drwxr-xr-x 2 gloryword gloryword  4096 Aug 31 20:54 plugins
    ```
    
    ì°¸ê³ ë¡œ `docker compose up airflow-init`, `docker compose up airflow-init`ëŠ” ê¼­ sudoê°€ ë“¤ì–´ê°€ì•¼ í•œë‹¤.
    
    ```powershell
    sudo docker compose up airflow-init í•˜ê³  ì¢€ ì‹œê°„ ê±¸ë¦¬ê³  ì½”ë“œ 0ì´ ë°˜í™˜ë˜ë©° ì„±ê³µ.
    sudo docker compose up ì¹˜ë©´ ë­”ê°€ ì—„ì²­ ëœ¬ë‹¤. ê·¸ê±° ë„ë©´ í”„ë¡œê·¸ë¨ ì¢…ë£Œë˜ë‹ˆê¹Œ ì´ ìƒíƒœë¡œ
    wsl í‚¤ê³ 
    sudo docker ps ì…ë ¥í•˜ë©´ Airflowë¥¼ ë„ìš°ëŠ”ë° í•„ìš”í•œ ì»¨í…Œì´ë„ˆ ëª©ë¡ë“¤ì„ ë³¼ ìˆ˜ ìˆë‹¤.
    
    gloryword@Doldari-Teenager:~$ sudo docker ps
    [sudo] password for gloryword:
    CONTAINER ID   IMAGE                  COMMAND                  CREATED          STATUS                    PORTS                                       NAMES
    774eb370367a   apache/airflow:2.7.0   "/usr/bin/dumb-init â€¦"   6 minutes ago    Up 6 minutes (healthy)    8080/tcp                                    gloryword-airflow-worker-1
    ed6d8d0bb9ab   apache/airflow:2.7.0   "/usr/bin/dumb-init â€¦"   6 minutes ago    Up 6 minutes (healthy)    8080/tcp                                    gloryword-airflow-scheduler-1
    364c3b64678f   apache/airflow:2.7.0   "/usr/bin/dumb-init â€¦"   6 minutes ago    Up 6 minutes (healthy)    8080/tcp                                    gloryword-airflow-triggerer-1
    9e7b56d69904   apache/airflow:2.7.0   "/usr/bin/dumb-init â€¦"   6 minutes ago    Up 6 minutes (healthy)    0.0.0.0:8080->8080/tcp, :::8080->8080/tcp   gloryword-airflow-webserver-1
    a111ad32c0a8   postgres:13            "docker-entrypoint.sâ€¦"   11 minutes ago   Up 11 minutes (healthy)   5432/tcp                                    gloryword-postgres-1
    4567720524cc   redis:latest           "docker-entrypoint.sâ€¦"   11 minutes ago   Up 11 minutes (healthy)   6379/tcp                                    gloryword-redis-1
    ```
    
    ì´ì œ [localhost](http://localhost):8080 ë¥¼ ì£¼ì†Œì— ì…ë ¥í•´ë³¸ë‹¤â€¦. : ë‘ê°œê°€ ì•„ë‹ˆë¼ í•œê°œë‹¤.
    
    
    <img src="./images/Airflow_FirstPage_Sucess.png" width="1000" height="400">
    ì§„ì§œ ëˆˆë¬¼ë‚œë‹¤. 5ì‹œê°„ ë„˜ê²Œ ê±¸ë ¸ë‹¤.
    
    ID,PWì˜ ê¸°ë³¸ê°’ì€ airflow ë¡œ ë™ì¼í•˜ë‹¤.